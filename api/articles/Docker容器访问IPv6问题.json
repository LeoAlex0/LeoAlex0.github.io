{"title":"Debian10配置Docker容器访问IPv6问题","uid":"a2311fa6d52a6ca0be67954ab2f15649","slug":"Docker容器访问IPv6问题","date":"2021-03-18T17:34:32.000Z","updated":"2021-03-18T17:34:32.000Z","comments":true,"path":"api/articles/Docker容器访问IPv6问题.json","keywords":null,"cover":null,"content":"<h2 id=\"打开docker的ipv6支持\">打开Docker的IPv6支持</h2>\n<p>若想要容器能够监听IPv6的接口，那么首先容器内部需要自己有个IPv6的接口。</p>\n<p>参见<a\nhref=\"https://docs.docker.com/config/daemon/ipv6/\">docker文档</a></p>\n<p>修改<code>/etc/docker/daemon.json</code>，合并以下JSON配置</p>\n<pre class=\"line-numbers language-json\" data-language=\"json\"><code class=\"language-json\">&#123;\n  &quot;ipv6&quot;: true,\n  &quot;fixed-cidr-v6&quot;: &quot;2001:db8:1::&#x2F;64&quot;\n&#125;<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span><span></span><span></span><span></span></span></code></pre>\n<p>然后自行<code>systemctl restart docker</code>之类重启<code>docker daemon</code>。</p>\n<p>其中第一项会开启默认的bridge\nnetwork的IPv6支持，下一个会在IPv6的地址池里添加对应的网段。</p>\n<p>不过很奇怪的是，这一个网段的<strong>全部</strong>地址都会分给全局默认的bridge\nnetwork，所以如果自己的docker-compose文件里有网络需要IPv6支持的，得手动分配一个网段，或者直接改用默认的全局bridge。</p>\n<h2 id=\"设置ip6tables转发流量\">设置ip6tables转发流量</h2>\n<p>搞定上面一步之后，理论上你容器内expose出的端口都可以监听IPv6的接口了。但若是想让容器内部访问IPv6的外网，还需要配置ip6tables转发流量。</p>\n<p>参见<a\nhref=\"https://github.com/docker/for-linux/issues/648\">这个issue</a></p>\n<p>使用如下命令转发收到的对应地址的流量。</p>\n<pre class=\"line-numbers language-bash\" data-language=\"bash\"><code class=\"language-bash\">ip6tables -t nat -A POSTROUTING -s 2001:db8:1::&#x2F;64 ! -o docker0 -j MASQUERADE<span aria-hidden=\"true\" class=\"line-numbers-rows\"><span></span></span></code></pre>\n<p>但总感觉这个方案还不够完美，只能说暂时够用了。</p>\n","feature":true,"text":"打开Docker的IPv6支持 若想要容器能够监听IPv6的接口，那么首先容器内部需要自己有个IPv6的接口。 参见docker文档 修改/etc/docker/daemon.json，合并以下JSON配置 { \"ipv6\": true, \"fixed-cidr-v6\": \"2001:db8:1::/64\" } 然后自行systemctl restart docker之类重启docker daemon。 其中第一项会开启默认的bridge network的IPv6支持，下一个会在IPv6的地址池里添加对应的网段。 不过很奇怪的是，这一个网段的全部地址都会分给全局默认的bridge networ...","link":"","photos":[],"count_time":{"symbolsCount":649,"symbolsTime":"1 mins."},"categories":[{"name":"网络","slug":"网络","count":2,"path":"api/categories/网络.json"}],"tags":[{"name":"Debian","slug":"Debian","count":1,"path":"api/tags/Debian.json"},{"name":"Docker","slug":"Docker","count":1,"path":"api/tags/Docker.json"},{"name":"IPv6","slug":"IPv6","count":1,"path":"api/tags/IPv6.json"}],"toc":"<ol class=\"toc\"><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E6%89%93%E5%BC%80docker%E7%9A%84ipv6%E6%94%AF%E6%8C%81\"><span class=\"toc-text\">打开Docker的IPv6支持</span></a></li><li class=\"toc-item toc-level-2\"><a class=\"toc-link\" href=\"#%E8%AE%BE%E7%BD%AEip6tables%E8%BD%AC%E5%8F%91%E6%B5%81%E9%87%8F\"><span class=\"toc-text\">设置ip6tables转发流量</span></a></li></ol>","author":{"name":"zLeoAlex","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/31839998?s=400&u=b0b96ba70683790361899dd0d4f58987c1857379","link":"/","description":"there are something should not be forgotten, though years apart.","socials":{"github":"https://github.com/LeoAlex0","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"luogu":{"icon":"/imgs/luogu-logo.png","link":"https://www.luogu.com.cn/user/48169"}}}},"mapped":true,"prev_post":{"title":"齐次坐标、线性代数与圆锥曲线-1","uid":"69c46b9206ea0522a8e522d7af48dd00","slug":"齐次坐标、线性代数与圆锥曲线-1","date":"2021-04-30T13:09:12.000Z","updated":"2021-04-30T13:09:12.000Z","comments":true,"path":"api/articles/齐次坐标、线性代数与圆锥曲线-1.json","keywords":null,"cover":null,"text":"简介 本文与其说是一篇文章，不如说是对于这篇文章的简化与总结。 最终目的是通过引入尽可能少的外部假定，使得我们可以从一个更高的视角看高中的圆锥曲线题。 基础要素 观察一个任意二次曲线 首先，我们可以做如下换元： 其中为任意实数，则我们可以有： 我们均可以将其写成矩阵相乘的形式: 故我们可以用一个实对称矩阵来表示一个二次曲线。 另外对于一条直线，如果我们做同样的换元，我们也可以以一个向量来表述它。 但为了不与点/坐标产生歧义，我们约定后文...","link":"","photos":[],"count_time":{"symbolsCount":"1.1k","symbolsTime":"1 mins."},"categories":[{"name":"数学","slug":"数学","count":2,"path":"api/categories/数学.json"},{"name":"几何","slug":"数学/几何","count":1,"path":"api/categories/数学/几何.json"}],"tags":[{"name":"数学","slug":"数学","count":2,"path":"api/tags/数学.json"},{"name":"齐次坐标","slug":"齐次坐标","count":1,"path":"api/tags/齐次坐标.json"}],"author":{"name":"zLeoAlex","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/31839998?s=400&u=b0b96ba70683790361899dd0d4f58987c1857379","link":"/","description":"there are something should not be forgotten, though years apart.","socials":{"github":"https://github.com/LeoAlex0","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"luogu":{"icon":"/imgs/luogu-logo.png","link":"https://www.luogu.com.cn/user/48169"}}}},"feature":true},"next_post":{"title":"[CW]Faberge easter eggs crush test题解(数学部分)","uid":"01937456cef72f998b8b619fdd155a88","slug":"CW-Faberge-easter-eggs-crush-test","date":"2020-06-27T13:34:50.000Z","updated":"2020-06-27T13:34:50.000Z","comments":true,"path":"api/articles/CW-Faberge-easter-eggs-crush-test.json","keywords":null,"cover":null,"text":"递推式 按照题意，若设所求函数为，则有： 生成函数 注意到其生成函数满足 移项可得： 解生成函数 令: 则: 莱布尼兹法则 注意如下同构 令 处理 解出 处理 解出 麦克劳林展开代入前置展开乘进换元乘进来交换求和顺序换元： 解 ","link":"","photos":[],"count_time":{"symbolsCount":123,"symbolsTime":"1 mins."},"categories":[{"name":"Online Judge","slug":"Online-Judge","count":2,"path":"api/categories/Online-Judge.json"},{"name":"CodeWars","slug":"Online-Judge/CodeWars","count":1,"path":"api/categories/Online-Judge/CodeWars.json"},{"name":"1Kyu","slug":"Online-Judge/CodeWars/1Kyu","count":1,"path":"api/categories/Online-Judge/CodeWars/1Kyu.json"}],"tags":[{"name":"组合数学","slug":"组合数学","count":1,"path":"api/tags/组合数学.json"},{"name":"生成函数","slug":"生成函数","count":1,"path":"api/tags/生成函数.json"}],"author":{"name":"zLeoAlex","slug":"blog-author","avatar":"https://avatars.githubusercontent.com/u/31839998?s=400&u=b0b96ba70683790361899dd0d4f58987c1857379","link":"/","description":"there are something should not be forgotten, though years apart.","socials":{"github":"https://github.com/LeoAlex0","twitter":"","stackoverflow":"","wechat":"","qq":"","weibo":"","zhihu":"","csdn":"","juejin":"","customs":{"luogu":{"icon":"/imgs/luogu-logo.png","link":"https://www.luogu.com.cn/user/48169"}}}}}}